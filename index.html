<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            #gear:hover, button:hover {
                cursor: pointer;
            }

            h1, h3 {
                text-align: center;
                color: white;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .settings_set_button {
                width: 50%;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: large;
                margin-top: 0.5em;
                background-color: greenyellow;
                border: 2px solid black;
            }

            .settings_set_button_inactive {
                width: 50%;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: large;
                margin-top: 0.5em;
                background-color: rgb(128, 128, 128);
                border: 2px solid black;
            }

            .settings_pg {
                position: absolute;
                width: 100%;
                overflow: hidden;
                left: 0;
            }

            .settings_pg_offscreen {
                position: absolute;
                width: 100%;
                overflow: hidden;
                left: 100%;
            }

            .settings_debug_txt {
                color: white;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: small;
            }

            .checkbox_p {
                width: 50%;
                margin: 0;
                color: white;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: medium;
            }

            ::-webkit-scrollbar {
                width: 5px;
            }
            
            ::-webkit-scrollbar-track {
                background: rgb(0, 0, 0, 0); 
            }
            
            ::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 10000px;
            }
            
            ::-webkit-scrollbar-thumb:hover {
                background: #555; 
            }
        </style>
        <link href="favicon.png" rel="icon">
        <title>Countdown</title>
    </head>
    <body style="background-color: black; overflow: hidden;">
        <img id="backImg" style="position: absolute; width: 100%; height: auto; top: 50%; left: 50%; transform: translate(-50%, -50%); filter: brightness(50%);" src="Backgrounds/Back1.jpg">
        <div id="music_playlist" style="position: absolute; left: -355.5px; margin: 0; padding: 0; top: 0; filter: brightness(0.5); pointer-events: none;"></div>
        <div id="bg_player" style="position: absolute; left: -355.5px; margin: 0; padding: 0; top: 0; filter: brightness(50%); pointer-events: none;"></div>
        <h1 id="title" style="position: absolute; left: 50%; transform: translateX(-50%); font-size: 350%; width: 100%; display: none;">Game Night @ 7:00pm HST</h1>
        <h1 id="Timer" style="margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 750%; color: white; border: 4px solid white; border-radius: 1000000px; padding: 1%; text-align: center; text-shadow: 0 0 16px #000; max-width: 90%; display: none;">Starting soon...</h1>
        <p id="footer" style="color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: large; text-align: center; position: absolute; bottom: 0; width: 50%; left: 25%; display: none;">Feel free to share any music recommendations you have! (Youtube only)</p>
        <div id="settingsContainer" style="overflow: hidden; width: calc(20% + 2px); height: 100vh; position: absolute; right: 0; top: 0;">
            <div id="settings" style="width: 100%; background-color: rgba(0, 0, 0, 0.5); height: 100%; position: absolute; left: 100%; top: 0; border-left: 2px inset #fff; backdrop-filter: blur(8px); text-align: center; overflow-x: hidden; overflow-y: auto; text-align: center;">    
                <div id="settings-pg-1" class="settings_pg">
                    <h1 style="font-size: xx-large;">General</h1>
                    <h3 style="font-weight: normal;">Title</h3>
                    <input id="titleIn" type="text" style="width: 75%; height: 1em; padding: 0.5em; background-color: rgba(0, 0, 0, 0); border: 2px solid white; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1em;" placeholder="Game Night @ 7:00pm HST">
                    <button id="titleSet" class="settings_set_button">Set</button>
                    <h3 style="font-weight: normal;">Countdown</h3>
                    <input id="timerDate" type="datetime-local" style="width: 75%; height: 1em; padding: 0.5em; background-color: rgba(0, 0, 0, 0); border: 2px solid black; color: black; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1.5em; filter: invert();">
                    <button id="timerSet" class="settings_set_button">Set</button>
                    <br>
                    <div style="display: flex; justify-content: center;">
                        <input id="needmorepeople" type="checkbox" style="margin: 0;">
                        <p class="checkbox_p">Not enough people</p>
                    </div>
                    <h3 style="font-weight: normal;">Footer</h3>
                    <input id="footerText" type="text" style="width: 75%; height: 1em; padding: 0.5em; background-color: rgba(0, 0, 0, 0); border: 2px solid white; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1em;" placeholder="Feel free to share any music recommendations you have! (Youtube only)" maxlength="85">
                    <button id="footerSet" class="settings_set_button">Set</button>
                </div>
                <div id="settings-pg-2" class="settings_pg_offscreen">
                    <h1 style="font-size: xx-large;">GUI</h1>
                    <h3 style="font-weight: normal;">Background</h3>
                    <select id="bgSelect" style="color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: normal; font-size: 1.25em; background-color: rgba(0, 0, 0, 0); margin: 0.5em; width: 75%;">
                        <option style="background-color: black;">Slideshow</option>
                        <option style="background-color: black;">Music Video</option>
                        <option style="background-color: black;">Custom Video</option>
                    </select>
                    <div id="VideoBg" style="display: none;">
                        <input id="bgID" type="text" style="width: 75%; height: 1em; padding: 0.5em; background-color: rgba(0, 0, 0, 0); border: 2px solid white; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1em;" placeholder="Video ID">
                        <p id="bgEg" style="color: gray; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: small; margin-top: 0;">Eg. "fz2Uio3xbEw"</p>
                    </div>
                    <button id="bgSet" class="settings_set_button">Set</button>
                    <h3 style="font-weight: normal;">GUI</h3>
                    <div style="display: flex; justify-content: center;">
                        <input id="titleShown" type="checkbox" style="margin: 0;" checked>
                        <p class="checkbox_p">Title</p>
                    </div>
                    <div style="display: flex; justify-content: center;">
                        <input id="timerShown" type="checkbox" style="margin: 0;" checked>
                        <p class="checkbox_p">Countdown</p>
                    </div>
                    <div style="display: flex; justify-content: center;">
                        <input id="footerShown" type="checkbox" style="margin: 0;" checked>
                        <p class="checkbox_p">Footer</p>
                    </div>
                    <div style="display: flex; justify-content: center;">
                        <input id="playingShown" type="checkbox" style="margin: 0;" checked>
                        <p class="checkbox_p">Music Info</p>
                    </div>
                    <button id="fullscreen" class="settings_set_button">Toggle Fullscreen</button>
                    <h3 style="font-weight: normal;">Display</h3>
                    <select id="mobileModeSelect" style="color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: normal; font-size: 1.25em; background-color: rgba(0, 0, 0, 0); margin: 0.5em;">
                        <option style="background-color: black;">Auto</option>
                        <option style="background-color: black;">Override</option>
                    </select>
                    <div id="mobileModeCheckmark" style="display: none; justify-content: center;">
                        <input id="mobileMode" type="checkbox" style="margin: 0;">
                        <p class="checkbox_p">Mobile Mode</p>
                    </div>
                    <h3 style="font-weight: normal;">Misc</h3>
                    <button id="cookieSave" class="settings_set_button">Save Settings</button>
                    <button id="cookieLoad" class="settings_set_button_inactive">Load Settings</button>
                </div>
                <div id="settings-pg-3" class="settings_pg_offscreen">
                    <h1 style="font-size: xx-large;">AUDIO</h1>
                    <select id="playingSelect" style="color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: normal; font-size: 1.25em; background-color: rgba(0, 0, 0, 0); margin: 0.5em;">
                        <option style="background-color: black;">Playlist</option>
                        <option style="background-color: black;">Video</option>
                    </select>
                    <input id="playlistID" type="text" style="width: 75%; height: 1em; padding: 0.5em; background-color: rgba(0, 0, 0, 0); border: 2px solid white; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1em;" placeholder="Playlist ID">
                    <p id="playlistEg" style="color: gray; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: small; margin-top: 0;">Eg. "PLCV1C6Xt0zUZWgMmUe_q1VxhRv5Ait0Zj"</p>
                    <button id="skipSong" class="settings_set_button">Skip Song</button>
                    <button id="playlistSet" class="settings_set_button">Set</button>
                    <h3 style="font-weight: normal;" id="VolumeHead">Volume (25%)</h3>
                    <input id="playerVol" type="range" min="0" max="100" value="25" style="width: 75%; margin: 0.5em;" step="1">
                    <p style="color: gray; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: small; margin-top: 0; position: absolute; left: 2.5em;">0%</p>
                    <p style="color: gray; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: small; margin-top: 0; position: absolute; width: 100%; text-align: center;">50%</p>
                    <p style="color: gray; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: small; margin-top: 0; position: absolute; right: 2.5em;">100%</p>
                </div>
                <div id="settings-pg-4" class="settings_pg_offscreen">
                    <h1 style="font-size: xx-large;">DEBUG</h1>
                    <h3 style="font-weight: normal;">Timer</h3>
                    <p id="timerDebug" class="settings_debug_txt">null</p>
                    <p id="timeRemainDebug" class="settings_debug_txt">0</p>
                    <h3 style="font-weight: normal;">Music</h3>
                    <p id="musicDebug" class="settings_debug_txt">null</p>
                    <h3 style="font-weight: normal;">Cookies</h3>
                    <p id="cookieDebug" class="settings_debug_txt">null</p>
                    <h3 style="font-weight: normal;">Screen</h3>
                    <p id="resDebug" class="settings_debug_txt">null</p>
                </div>
            </div>

            <div id="settings-pg-control" style="width: 100%; height: fit-content; position: absolute; left: 100%; bottom: 0; margin: 2px; margin-bottom: 0;">
                <button id="LastPg" class="settings_set_button_inactive" style="background-color: rgb(128, 128, 128); position: absolute; left: 0; bottom: 0; width: 20%;">Last Page</button>
                <button id="NextPg" class="settings_set_button" style="background-color: greenyellow; position: absolute; right: 0; bottom: 0; width: 20%;">Next Page</button>
            </div>
        </div>
        <img id="gear" src="gear.png" style="width: 48px; right: 8px; position: absolute; bottom: 4px; display: none;">
        <p style="color: white; position: absolute; left: 0.1em; bottom: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0;">©2024 Alex Gan | <a href="https://github.com/Alex33278/Countdown/tree/main" style="color: rgb(56, 103, 255);" target="_blank">Github</a></p>
        <p id="NowPlaying" style="color: white; position: absolute; top: 0; left: 0.1em; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; font-size: 1.3em; display: none;">♫ Now Playing: <a id="NowPlayingVideo" style="color: white;" target="_blank"></a></p>
        <p id="NowPlayingInfo" style="color: rgb(200, 200, 200); position: absolute; top: 1.5em; left: 0.1em; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; font-size: 1em;"></p>
        <p id="ClickAnywhere" style="color: rgb(180, 180, 180); position: absolute; left: 50%; transform: translateX(-50%); bottom: 0.1em; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 350%; user-select: none;">Loading...</p>
        <p id="Warning" style="color: red; position: absolute; left: 50%; transform: translateX(-50%); top: 1em; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 200%; user-select: none;"></p>

        <script>
            function mobileModeSelectInput() {
                if (document.getElementById("mobileModeSelect").value == "Auto") {
                    document.getElementById("mobileModeCheckmark").style.display = "none"
                    mobileOverride = -1
                } else {
                    document.getElementById("mobileModeCheckmark").style.display = "flex"
                }
            }

            document.getElementById("mobileModeSelect").oninput = mobileModeSelectInput

            document.getElementById("mobileMode").oninput = function() {
                mobileOverride = document.getElementById("mobileMode").checked
            }
        </script>
        <script>
            let ctrlDown = false
            let shiftDown = false

            document.addEventListener("keydown", function(e) {
                if (e.keyCode == 9) {
                    e.preventDefault()
                }

                if (e.keyCode == 89 && ctrlDown && shiftDown) {
                    numPg = 4
                    let requestAmount = numPg - pg

                    console.log(requestAmount)

                    for (var i = 0; i < requestAmount; i++) {
                        requestQueue.push("Next")
                    }
                }

                if (e.keyCode == 17) {
                    ctrlDown = true
                }

                if (e.keyCode == 16) {
                    shiftDown = true
                }
            })

            document.addEventListener("keyup", function(e) {
                if (e.keyCode == 17) {
                    ctrlDown = false
                }

                if (e.keyCode == 16) {
                    shiftDown = false
                }
            })
        </script>
        <script>
            function CheckGUI() {
                if (document.getElementById("titleShown").checked) {
                    document.getElementById("title").style.display = "block"
                } else {
                    document.getElementById("title").style.display = "none"
                }

                if (document.getElementById("timerShown").checked) {
                    document.getElementById("Timer").style.display = "block"
                } else {
                    document.getElementById("Timer").style.display = "none"
                }

                if (document.getElementById("footerShown").checked) {
                    document.getElementById("footer").style.display = "block"
                } else {
                    document.getElementById("footer").style.display = "none"
                }

                if (document.getElementById("playingShown").checked) {
                    document.getElementById("NowPlaying").style.display = "block"
                    document.getElementById("NowPlayingInfo").style.display = "block"
                } else {
                    document.getElementById("NowPlaying").style.display = "none"
                    document.getElementById("NowPlayingInfo").style.display = "none"
                }
            }

            document.getElementById("titleShown").oninput = CheckGUI
            document.getElementById("timerShown").oninput = CheckGUI
            document.getElementById("footerShown").oninput = CheckGUI
            document.getElementById("playingShown").oninput = CheckGUI

            function ToggleFullscreen() {
                if (document.fullscreenElement) {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                } else {
                    if (document.documentElement.requestFullscreen) {
                        document.documentElement.requestFullscreen();
                    } else if (document.documentElement.webkitRequestFullscreen) {
                        document.documentElement.webkitRequestFullscreen();
                    } else if (document.documentElement.msRequestFullscreen) {
                        document.documentElement.msRequestFullscreen();
                    }
                }
            }

            document.getElementById("fullscreen").onclick = ToggleFullscreen
        </script>
        <script>
            var muteVid = false
            var isMobile = checkMobile()
            var mobile = false
            var mobileOverride = -1

            if (/\bCrOS\b/.test(navigator.userAgent)) {
                document.getElementById("Warning").innerText = "ChromeOS Detected! Music is muted by default."
                document.getElementById("playerVol").value = 0
                document.getElementById("VolumeHead").innerText = "Volume (0%)"
                mobileOverride = 0
                muteVid = true
            }

            function checkMobile() {
                return (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))
            };

            function SetGuiMode(mobileMode) {
                if (mobileMode) {
                    if (document.getElementById("Warning")) {
                        document.getElementById("Warning").innerText = "Mobile mode is not fully supported!"
                        document.getElementById("Warning").style.fontSize = "large"
                    }

                    if (document.getElementById("ClickAnywhere")) {
                        document.getElementById("ClickAnywhere").style.fontSize = "large"
                    }
                    
                    document.getElementById("Timer").style.fontSize = "300%"
                    document.getElementById("title").style.fontSize = "xx-large"
                    document.getElementById("footer").style.fontSize = "medium"
                    document.getElementById("NowPlaying").style.fontSize = "small"
                    document.getElementById("NowPlayingInfo").style.fontSize = "small"
                    document.getElementById("footer").style.bottom = "1em"
                    document.getElementById("settingsContainer").style.width = "calc(40% + 2px)"

                    document.getElementById("mobileMode").checked = true
                    mobile = true
                } else {
                    if (document.getElementById("Warning")) {
                        document.getElementById("Warning").innerText = ""
                        document.getElementById("Warning").style.fontSize = "200%"
                    }

                    if (document.getElementById("ClickAnywhere")) {
                        document.getElementById("ClickAnywhere").style.fontSize = "350%"
                    }

                    document.getElementById("Timer").style.fontSize = "750%"
                    document.getElementById("title").style.fontSize = "350%"
                    document.getElementById("footer").style.fontSize = "large"
                    document.getElementById("NowPlaying").style.fontSize = "1.3em"
                    document.getElementById("NowPlayingInfo").style.fontSize = "1em"
                    document.getElementById("footer").style.bottom = "0"
                    document.getElementById("settingsContainer").style.width = "calc(20% + 2px)"
                    
                    document.getElementById("mobileMode").checked = false
                    mobile = false
                }
            }

            setInterval(() => {
                document.getElementById("resDebug").innerText = window.innerWidth + "x" + window.innerHeight

                if (mobileOverride != -1) {
                    SetGuiMode(mobileOverride)
                    return
                }

                if (isMobile || (window.innerWidth < 1200 || window.innerHeight < 600)) {
                    SetGuiMode(true)
                } else {
                    SetGuiMode(false)
                }
            }, 100);
            

            let readyInterval = setInterval(() => {
                if (document.readyState == "complete" && !muteVid) {
                    if (mobile) {
                        document.getElementById("ClickAnywhere").innerText = "Click on video to start"

                        let music_playlist = document.getElementById("music_playlist")
                        music_playlist.style.left = "50%"
                        music_playlist.style.top = "50%"
                        music_playlist.style.transform = "translate(-50%, -50%)"
                        music_playlist.style.pointerEvents = "all"
                    } else {
                        document.getElementById("ClickAnywhere").innerText = "Press any key to start"

                        let music_playlist = document.getElementById("music_playlist")
                        music_playlist.style.left = "-355.5px"
                        music_playlist.style.top = "0"
                        music_playlist.style.transform = "translate(0, 0)"
                        music_playlist.style.pointerEvents = "none"
                    }
                }
            }, 10);
        </script>
        <script>
            function setCookie(cname, cvalue) {
                const d = new Date()
                d.setTime(d.getTime() + 31536000000)
                let expires = "expires="+d.toUTCString()
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/"
            }

            function getCookie(cname) {
                let name = cname + "="
                let ca = document.cookie.split(';')

                for(let i = 0; i < ca.length; i++) {
                    let c = ca[i]
                    while (c.charAt(0) == ' ') {
                        c = c.substring(1)
                    }
                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length)
                    }
                }

                return ""
            }

            document.getElementById("cookieSave").onclick = function() {
                setCookie("title", document.getElementById("titleIn").value)
                setCookie("timerDate", document.getElementById("timerDate").value)
                setCookie("needmorepeople", document.getElementById("needmorepeople").checked)
                setCookie("playlistID", document.getElementById("playlistID").value)
                setCookie("playerVol", document.getElementById("playerVol").value)
                setCookie("footerText", document.getElementById("footerText").value)
                setCookie("playingSelect", document.getElementById("playingSelect").value)
                setCookie("bgSelect", document.getElementById("bgSelect").value)
                setCookie("bgID", document.getElementById("bgID").value)
                setCookie("titleShown", document.getElementById("titleShown").checked)
                setCookie("timerShown", document.getElementById("timerShown").checked)
                setCookie("footerShown", document.getElementById("footerShown").checked)
                setCookie("playingShown", document.getElementById("playingShown").checked)
                setCookie("mobileModeSelect", document.getElementById("mobileModeSelect").value)
                setCookie("mobileMode", document.getElementById("mobileMode").checked)

                if (document.cookie !== "") {
                    document.getElementById("cookieLoad").style.backgroundColor = "greenyellow"
                    document.getElementById("cookieDebug").innerText = document.cookie
                }
            }

            document.getElementById("cookieLoad").onclick = function() {
                if (document.cookie == "") {
                    return
                }

                document.getElementById("titleIn").value = getCookie("title")
                document.getElementById("timerDate").value = getCookie("timerDate")
                document.getElementById("playerVol").value = getCookie("playerVol")
                document.getElementById("footerText").value = getCookie("footerText")
                document.getElementById("playlistID").value = getCookie("playlistID")
                document.getElementById("playingSelect").value = getCookie("playingSelect")
                document.getElementById("bgSelect").value = getCookie("bgSelect")
                document.getElementById("bgID").value = getCookie("bgID")
                document.getElementById("titleShown").checked = getCookie("titleShown")
                document.getElementById("timerShown").checked = getCookie("timerShown")
                document.getElementById("footerShown").checked = getCookie("footerShown")
                document.getElementById("playingShown").checked = getCookie("playingShown")
                document.getElementById("mobileMode").checked = getCookie("mobileMode")
                document.getElementById("mobileModeSelect").value = getCookie("mobileModeSelect")

                if (getCookie("playlistID") == "") {
                    document.getElementById("playlistID").value = "PLCV1C6Xt0zUZWgMmUe_q1VxhRv5Ait0Zj"
                }

                document.getElementById("titleSet").click()
                document.getElementById("timerSet").click()
                document.getElementById("needmorepeople").checked = getCookie("needmorepeople")
                document.getElementById("playlistSet").click()
                document.getElementById("footerSet").click()
                document.getElementById("VolumeHead").innerText = "Volume (" + document.getElementById("playerVol").value + "%)"

                playingSelectFunc()
                bgSelectFunc()
                document.getElementById("bgSet").click()
                CheckGUI()
                mobileModeSelectInput()

                document.getElementById("cookieSave").click()
            }

            if (document.cookie !== "") {
                document.getElementById("cookieLoad").style.backgroundColor = "greenyellow"
                document.getElementById("cookieDebug").innerText = document.cookie
            }
        </script>
        <script>
            var settingsOpen = false
            var t = 1
            var pg = 1
            var numPg = 3
            var d = false
            var requestQueue = []

            document.getElementById("NextPg").innerText = ">"
            document.getElementById("LastPg").innerText = "<"

            document.getElementById("NextPg").onclick = function() {
                if (!d && pg < numPg) {
                    TransitionPg(pg++)
                }
            }

            document.getElementById("LastPg").onclick = function() {
                if (!d && pg > 1) {
                    TransitionPg(pg--)
                }
            }

            document.getElementById("gear").onclick = function() {
                settingsOpen = !settingsOpen
                t = 0
            }

            setInterval(() => {
                if (requestQueue.length > 0) {
                    if (!d) {
                        if (requestQueue[0] == "Next") {
                            TransitionPg(pg++)
                            requestQueue.shift()
                        }
                    }
                }
            }, 10);

            function TransitionPg(lastPg) {
                d = true
                let frame = 0

                if (pg > 1) {
                    document.getElementById("LastPg").style.backgroundColor = "greenyellow"
                } else {
                    document.getElementById("LastPg").style.backgroundColor = "rgb(128, 128, 128)"
                }

                if (pg < numPg) {
                    document.getElementById("NextPg").style.backgroundColor = "greenyellow"
                } else {
                    document.getElementById("NextPg").style.backgroundColor = "rgb(128, 128, 128)"
                }

                if (lastPg < pg) {
                    let interval = setInterval(() => {
                        let t = (1 - Math.min(frame, 1)) * 0 + Math.min(frame, 1) * 100
                        let revT = 100 - t

                        document.getElementById("settings-pg-" + lastPg).style.left = "-" + t + "%"
                        document.getElementById("settings-pg-" + pg).style.left = revT + "%"

                        frame += 0.02

                        if (frame > 1) {
                            clearInterval(interval)
                            document.getElementById("settings-pg-" + pg).style.left = "0"
                            d = false
                        }
                    }, 10);
                } else {
                    let interval = setInterval(() => {
                        let t = (1 - Math.min(frame, 1)) * 0 + Math.min(frame, 1) * 100
                        let revT = 100 - t

                        document.getElementById("settings-pg-" + pg).style.left = "-" + revT + "%"
                        document.getElementById("settings-pg-" + lastPg).style.left = t + "%"

                        frame += 0.02

                        if (frame > 1) {
                            clearInterval(interval)
                            document.getElementById("settings-pg-" + pg).style.left = "0"
                            d = false
                        }
                    }, 10);
                }
            }

            function settingsTranslate() {
                if (t > 1) {t = 1}

                if (settingsOpen) {
                    document.getElementById("settings").style.left = ((1 - t) * 100) + "%"
                    document.getElementById("settings-pg-control").style.left = ((1 - t) * 100) + "%"
                    document.getElementById("gear").style.rotate = -(360 * t) + "deg"
                    document.getElementById("gear").style.right = "calc(" + (t * (mobile ? 40 : 20)) + "% + 8px)"
                } else {
                    if (t == 1) {
                        document.getElementById("settings").style.left = "calc(100% + 2px)"
                        document.getElementById("settings-pg-control").style.left = "calc(100% + 2px)"
                        document.getElementById("gear").style.rotate = "360deg"
                        document.getElementById("gear").style.right = "8px"
                    } else {
                        document.getElementById("settings").style.left = (t * 100) + "%"
                        document.getElementById("settings-pg-control").style.left = (t * 100) + "%"
                        document.getElementById("gear").style.rotate = (360 * t) + "deg"
                        document.getElementById("gear").style.right = "calc(" + ((1 - t) * (mobile ? 40 : 20)) + "% + 8px)"
                    }
                }

                t += 0.02
            }

            setInterval(() => {
                settingsTranslate()
            }, 10)
        </script>
        <script async src="https://www.youtube.com/iframe_api"></script>
        <script>
            var player
            var bg_player_var
            var shuffle = false
            var started = false
            var startTimer = false

            function onYouTubeIframeAPIReady() {
                player = new YT.Player('music_playlist', {
                    width: 355.5,               // Player width (in px)
                    height: 200,              // Player height (in px)
                    playerVars: {
                        listType:'playlist',
                        list: 'PLCV1C6Xt0zUZWgMmUe_q1VxhRv5Ait0Zj',
                        enablejsapi: 1,
                        autoplay: 1,        // Auto-play the video on load
                        controls: 0,        // Show pause/play buttons in player
                        showinfo: 0,        // Hide the video title
                        modestbranding: 1,  // Hide the Youtube Logo
                        loop: true,            // Run the video in a loop
                        fs: 0,              // Hide the full screen button
                        cc_load_policy: 0, // Hide closed captions
                        iv_load_policy: 3,  // Hide the Video Annotations
                        autohide: 1         // Hide video controls when playing
                    },
                    events: {
                        onError: function(e) {
                            e.target.nextVideo()
                            e.target.playVideo()
                        },
                        onReady: function(e) {
                            player.setVolume(muteVid ? 0 : 25)
                            
                            let interval = setInterval(() => {
                                if (started) {
                                    clearInterval(interval)
                                    clearInterval(readyInterval)

                                    let music_playlist = document.getElementById("music_playlist")
                                    music_playlist.style.left = "-355.5px"
                                    music_playlist.style.top = "0"
                                    music_playlist.style.transform = "translate(0, 0)"
                                    music_playlist.style.pointerEvents = "none"
                                    document.getElementById("NowPlaying").style.display = "block"
                                    
                                    let frame2 = 0
                                    let interval2 = setInterval(() => {
                                        frame2 += 0.01
                                        let alpha = (1 - Math.min(frame2, 1)) * 1 + Math.min(frame2, 1) * 0

                                        document.getElementById("ClickAnywhere").style.color = "rgb(255, 255, 255, " + alpha + ")"
                                        document.getElementById("Warning").style.color = "rgb(255, 0, 0, " + alpha + ")"

                                        if (frame2 >= 1) {
                                            clearInterval(interval2)

                                            setTimeout(() => {
                                                document.getElementById("ClickAnywhere").remove()
                                                document.getElementById("gear").style.display = "block"
                                                document.getElementById("footer").style.display = "block"
                                                document.getElementById("title").style.display = "block"
                                                document.getElementById("Timer").style.display = "block"
                                                document.getElementById("Warning").remove()
                                                
                                                document.getElementById("footer").style.color = "rgb(255, 255, 255, 0)"
                                                document.getElementById("title").style.color = "rgb(255, 255, 255, 0)"
                                                document.getElementById("Timer").style.color = "rgb(255, 255, 255, 0)"
                                                document.getElementById("Timer").style.border = "4px solid rgb(255, 255, 255, 0)"
                                                document.getElementById("gear").style.opacity = 0
                                                document.getElementById("Timer").style.textShadow = "text-shadow: 0 0 16px rgb(0, 0, 0, 0)"

                                                let frame3 = 0
                                                let interval3 = setInterval(() => {
                                                    frame3 += 0.01
                                                    let alpha2 = (1 - Math.min(frame3, 1)) * 0 + Math.min(frame3, 1) * 1

                                                    document.getElementById("footer").style.color = "rgb(255, 255, 255, " + alpha2 + ")"
                                                    document.getElementById("title").style.color = "rgb(255, 255, 255, " + alpha2 + ")"
                                                    document.getElementById("Timer").style.color = "rgb(255, 255, 255, " + alpha2 + ")"
                                                    document.getElementById("Timer").style.border = "4px solid rgb(255, 255, 255, " + alpha2 + ")"
                                                    document.getElementById("gear").style.opacity = alpha2
                                                    document.getElementById("Timer").style.textShadow = "text-shadow: 0 0 16px rgb(0, 0, 0, " + alpha2 + ")"

                                                    if (frame3 >= 1) {
                                                        clearInterval(interval3)
                                                        startTimer = true
                                                    }
                                                }, 10)
                                            }, 1000)
                                        }
                                    }, 10)
                                }

                                player.playVideo()
                            }, 10)
                        },
                        onStateChange: function(e) {
                            if (e.data == 1) {
                                if (!shuffle) {
                                    shuffle = true
                                    player.setLoop(true)
                                    e.target.setShuffle(true)
                                    e.target.nextVideo()
                                    e.target.playVideo()
                                }

                                document.getElementById("NowPlayingVideo").innerText = player.getVideoData().title
                                document.getElementById("NowPlayingVideo").setAttribute("href", player.getVideoUrl())
                                started = true
                            }

                            if (e.data == 0 && document.getElementById("playingSelect").value == "Video") {
                                e.target.playVideo()
                            }

                            document.getElementById("musicDebug").innerText = e.data
                        }
                    }
                })

                bg_player_var = new YT.Player('bg_player', {
                    width: 355.5,               // Player width (in px)
                    height: 200,              // Player height (in px)
                    playerVars: {
                        enablejsapi: 1,
                        autoplay: 1,        // Auto-play the video on load
                        controls: 0,        // Show pause/play buttons in player
                        showinfo: 0,        // Hide the video title
                        modestbranding: 1,  // Hide the Youtube Logo
                        loop: true,            // Run the video in a loop
                        fs: 0,              // Hide the full screen button
                        cc_load_policy: 0, // Hide closed captions
                        iv_load_policy: 3,  // Hide the Video Annotations
                        autohide: 1         // Hide video controls when playing
                    },
                    events: {
                        onError: function(e) {
                            bg_player_var.nextVideo()
                            bg_player_var.playVideo()
                        },
                        onReady: function(e) {
                            bg_player_var.setVolume(0)
                        },
                        onStateChange: function(e) {
                            if (e.data == 1) {
                                bg_player_var.setLoop(true)
                            }

                            if (e.data == 0) {
                                bg_player_var.playVideo()
                            }
                        }
                    }
                })
            }
            
            document.getElementById("playlistSet").onclick = function() {
                player.setLoop(false)

                if (document.getElementById("playingSelect").value == "Playlist") { // OPTIMIZE THIS MOTHERFUCKING THING
                    player.loadPlaylist({list: document.getElementById("playlistID").value, listType: "playlist"})
                    player.nextVideo()
                    player.playVideo()

                    setTimeout(() => {
                        player.loadPlaylist({list: document.getElementById("playlistID").value, listType: "playlist"})
                        player.nextVideo()
                        player.playVideo()
                        shuffle = false
                    }, 1000)
                } else {
                    player.loadVideoById(document.getElementById("playlistID").value)
                    shuffle = false
                }
            }

            document.getElementById("playerVol").oninput = function() {
                let vol = document.getElementById("playerVol").value
                player.setVolume(vol)
                document.getElementById("VolumeHead").innerText = "Volume (" + vol + "%)"
            }

            function playingSelectFunc() {
                if (document.getElementById("playingSelect").value == "Video") {
                    document.getElementById("playlistID").setAttribute("placeholder", "Video ID")
                    document.getElementById("playlistEg").innerText = "Eg. \"fz2Uio3xbEw\""
                    document.getElementById("skipSong").style.display = "none"
                } else {
                    document.getElementById("playlistID").setAttribute("placeholder", "Playlist ID")
                    document.getElementById("playlistEg").innerText = "Eg. \"PLCV1C6Xt0zUZWgMmUe_q1VxhRv5Ait0Zj\""
                    document.getElementById("skipSong").style.display = "inline-block"
                }
            }

            document.getElementById("playingSelect").oninput = playingSelectFunc

            setInterval(() => {
                if (!started) { return }
                let data = player.getVideoData()

                if (!data.author) {
                    document.getElementById("NowPlayingVideo").innerText = ""
                    document.getElementById("NowPlayingInfo").innerText = ""
                    return
                }

                if (data.isLive) {
                    document.getElementById("NowPlayingInfo").innerText = "by: " + player.getVideoData().author + " | (Live)"
                } else {
                    document.getElementById("NowPlayingInfo").innerText = "by: " + player.getVideoData().author + " | (" + format(player.getCurrentTime() * 1000, false) + "/" + format(player.getDuration() * 1000, false) + ")"
                }
                
            }, 10)

            let yt_player_interval = undefined
            let bg_player_interval = undefined

            function bgSelectFunc() {
                if (document.getElementById("bgSelect").value == "Custom Video") {
                    document.getElementById("VideoBg").style.display = "block"
                } else {
                    document.getElementById("VideoBg").style.display = "none"
                }
            }

            document.getElementById("bgSelect").oninput = bgSelectFunc

            document.getElementById("bgSet").onclick = function() {
                let bgSelectVal = document.getElementById("bgSelect").value

                if (bgSelectVal == "Custom Video") {
                    if (bg_player_interval) {
                        clearInterval(bg_player_interval)
                        bg_player_interval = undefined
                    }

                    document.getElementById("VideoBg").style.display = "block"
                    bg_player_var.setLoop(false)
                    bg_player_var.loadVideoById(document.getElementById("bgID").value)
                    document.getElementById("bg_player").left = "0"
                    bg_player_var.getIframe().style.left = "0"
                    bg_player_interval = setInterval(() => {
                        bg_player_var.getIframe().setAttribute("width", window.innerWidth)
                        bg_player_var.getIframe().setAttribute("height", window.innerHeight)
                    }, 10);
                } else {
                    document.getElementById("VideoBg").style.display = "none"
                    document.getElementById("bg_player").left = "-355.5px"
                    bg_player_var.getIframe().style.left = "-355.5px"

                    if (bg_player_interval) {
                        clearInterval(bg_player_interval)
                        bg_player_interval = undefined
                    }

                    bg_player_var.getIframe().setAttribute("width", "355.5px")
                    bg_player_var.getIframe().setAttribute("height", "200px")
                }

                if (bgSelectVal == "Music Video") {
                    if (yt_player_interval) {
                        clearInterval(yt_player_interval)
                        yt_player_interval = undefined
                    }

                    document.getElementById("music_playlist").style.left = "0"
                    yt_player_interval = setInterval(() => {
                        player.getIframe().setAttribute("width", window.innerWidth)
                        player.getIframe().setAttribute("height", window.innerHeight)
                    }, 10);
                } else {
                    document.getElementById("music_playlist").style.left = "-355.5px"

                    if (yt_player_interval) {
                        clearInterval(yt_player_interval)
                        yt_player_interval = undefined
                    }

                    player.getIframe().setAttribute("width", "355.5px")
                    player.getIframe().setAttribute("height", "200px")
                }
            }

            document.getElementById("skipSong").onclick = function() {
                player.nextVideo()
            }
        </script>
        <script>
            let frame = 0
            let bgs = []
            const TESTING = false

            if (TESTING) {
                let numBgs = 10
                let bgFileType = [".png", ".jpg", ".jpeg", ".webp", ".gif", ".svg", ".apng", ".avif"]

                for (let index = 0; index < numBgs; index++) {
                    let found = false

                    for (let index2 = 0; index2 < bgFileType.length; index2++) {
                        const element = bgFileType[index2]
                        
                        fetch("Backgrounds/Back" + index + element, {mode: "no-cors", method: "GET"})
                        .then(() => {
                            bgs.push("Back" + index + element)
                            found = true
                        })
                        .catch()

                        if (found) {
                            break
                        }
                    }
                }

                console.log(bgs)
            } else {
                bgs = [
                    "Back0.png",
                    "Back1.jpg",
                    "Back2.png",
                    "Back3.png",
                    "Back4.png",
                    "Back5.png",
                    "Back6.jpg",
                    "Back7.png",
                    "Back8.webp",
                    "Back9.webp"
                ]
            }

            function BackCycle() {
                // 100 frames = 1 sec

                if (frame % 500 >= 450) {
                    let t = ((frame % 500) - 450) / 50
                    document.getElementById("backImg").style.filter = "brightness(" + (((1 - t) * 50) + (t * 0)) + "%" + ")"
                } else if ((frame % 500) <= 50) {
                    let t = (frame % 500) / 50
                    document.getElementById("backImg").style.filter = "brightness(" + (((1 - t) * 0) + (t * 50)) + "%" + ")"
                } else {
                    document.getElementById("backImg").style.filter = "brightness(50%)"
                }

                for (let i = 0; i < bgs.length; i++) {
                    if (Math.floor(frame / 500) % bgs.length == i) {
                        document.getElementById("backImg").src = "Backgrounds/" + bgs[i]
                    }
                }
                
                frame++
            }

            setInterval(BackCycle, 10)

            function format(ms, countdown) {
                let sec = Math.floor(ms / 1000) % 60
                let min = Math.floor(ms / 60000) % 60
                let hour = Math.floor(ms / 3600000) % 24
                let day = Math.floor(ms / 86400000) % 365
                let year = Math.floor(ms / 31557600000)

                if (year == 0 && day == 0 && hour == 0 && min == 10 && sec == 0 && countdown) {
                    document.getElementById("Timer").style.color = "red"
                } else if (year == 0 && day == 0 && hour == 0 && min == 15 && sec == 0 && countdown) {
                    document.getElementById("Timer").style.color = "red"
                } else if ((year == 0 && day == 0 && hour == 0 && min < 5 || (year == 0 && day == 0 && hour == 0 && min == 5 && sec == 0)) && countdown) {
                    if (sec % 2 == 0) {
                        document.getElementById("Timer").style.color = "red"
                    } else {
                        document.getElementById("Timer").style.color = "white"
                    }
                } else if (year == 0 && day == 0 && hour == 0 && min == 30 && sec == 0 && countdown) {
                    document.getElementById("Timer").style.color = "red"
                } else {
                    if (countdown) {
                        document.getElementById("Timer").style.color = "white"
                    }
                }

                if (year > 0) {
                    return year.toString() + "y " + day.toString() + "d " + hour.toString() + ":" + ("00" + min.toString()).slice(-2) + ":" + ("00" + sec.toString()).slice(-2)
                }

                if (day > 0) {
                    return day.toString() + "d " + hour.toString() + ":" + ("00" + min.toString()).slice(-2) + ":" + ("00" + sec.toString()).slice(-2)
                }

                if (hour > 0) {
                    return hour.toString() + ":" + ("00" + min.toString()).slice(-2) + ":" + ("00" + sec.toString()).slice(-2)
                }

                if (countdown) {
                    return ("00" + min.toString()).slice(-2) + ":" + ("00" + sec.toString()).slice(-2)
                }

                return min.toString() + ":" + ("00" + sec.toString()).slice(-2)
            }

            let time = new Date()

            function tick() {
                let now = new Date()
                let waitAmount = time - now

                document.getElementById("settingsContainer").style.height = window.innerHeight + "px"
                //document.body.style.height = window.innerHeight + "px"
                document.getElementById("timeRemainDebug").innerText = waitAmount / 1000

                if (startTimer) {
                    if (waitAmount < 0) {
                        if (document.getElementById("needmorepeople").checked) {
                            document.getElementById("Timer").innerText = "Waiting for people..."
                            document.getElementById("Timer").style.color = "white"
                            return
                        } else {
                            document.getElementById("Timer").innerText = "Starting soon..."
                            document.getElementById("Timer").style.color = "white"
                        }
                    } else {
                        document.getElementById("Timer").innerText = format(waitAmount, true)
                    }
                }
            }

            setInterval(tick, 10)

            document.getElementById("timerSet").onclick = function() {
                time = new Date(document.getElementById("timerDate").value)
                document.getElementById("timerDebug").innerText = document.getElementById("timerDate").value
            }

            document.getElementById("titleSet").onclick = function() {
                if (document.getElementById("titleIn").value.trim() == "") {
                    document.getElementById("title").innerText = "Game Night @ 7:00pm HST"
                } else {
                    document.getElementById("title").innerText = document.getElementById("titleIn").value.trim()
                }
            }
            document.getElementById("footerSet").onclick = function() {
                if (document.getElementById("footerText").value.trim() == "") {
                    document.getElementById("footer").innerText = "Feel free to share any music recommendations you have! (Youtube only)"
                } else {
                    document.getElementById("footer").innerText = document.getElementById("footerText").value.trim()
                }
            }
        </script>
    </body>
</html>